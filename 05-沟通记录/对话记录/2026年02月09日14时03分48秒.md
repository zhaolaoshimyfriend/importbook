# AI助手对话记录

## 对话信息
- **日期**: 2026年02月09日 14时03分48秒
- **主题**: 科目映射中间表设计方案
- **关键字**: 需求分析

## 对话内容

**Q: 需求分析：在完成科目映射后，我希望能够生成一个映射前源系统的科目情况，和经过程序后映射过的结果，用户可以在这个基础上对结果进行修改，修改确认后，程序按照这个映射结果进行后续导账处理流程。请你先参考现在其他财务软件的设计，帮我构思一下怎么设计这个中间表，告诉我每个字段设计的意义**

**A:** 

我为你设计了一套完整的科目映射中间表结构，参考了用友、金蝶等主流财务软件的设计，并结合了现代系统的需求。

### 核心设计思路

中间表需要同时记录：
1. **映射前的源系统科目信息**（完整保留原始数据）
2. **映射后的目标系统科目信息**（程序匹配或用户确认的结果）
3. **匹配过程信息**（匹配类型、方法、评分、依据等）
4. **处理状态信息**（待处理、已匹配、已确认等）
5. **审计追踪信息**（谁、什么时候、做了什么操作）

### 主要字段分类

#### 1. 基础标识字段（4个）
- `id`：主键
- `mapping_batch_id`：映射批次ID（支持批量导账）
- `source_system_code/name`：源系统标识

#### 2. 源系统科目信息字段（12个）
- 科目编码、名称（原始+清洗后）
- 父科目信息、层级、类型、方向
- 辅助核算信息、启用状态、备注

#### 3. 目标系统科目信息字段（7个）
- 目标科目编码、名称、层级、类型、方向
- 辅助核算信息

#### 4. 匹配过程字段（7个）
- `match_type`：匹配类型（完全匹配/语义匹配/手动映射等）
- `match_method`：匹配方法（直接匹配/大模型/规则匹配等）
- `match_score`：匹配度评分（0-100）
- `match_confidence`：匹配置信度（高/中/低）
- `match_reason`：匹配依据说明
- `candidate_subjects`：候选科目列表
- `llm_response`：大模型原始响应

#### 5. 处理状态字段（8个）
- `mapping_status`：映射状态（待处理/已匹配/已确认等）
- `review_status`：审核状态
- `is_confirmed`：是否已确认
- `is_modified`：是否被用户修改
- `validation_result`：验证结果
- `conflict_flag`：是否存在冲突

#### 6. 审计追踪字段（11个）
- 创建、匹配、修改、确认、审核的时间和操作人
- `version`：版本号（支持版本管理）

#### 7. 业务扩展字段（5个）
- `remark`：备注
- `tag`：标签
- `priority`：优先级
- `export_flag`：是否导出到后续流程
- `template_id`：使用的映射模板ID

### 关键设计亮点

1. **完整的数据保留**：原始数据（`*_original`字段）和清洗后数据分开存储
2. **灵活的匹配方式**：支持多种匹配类型和方法
3. **匹配质量评估**：通过评分和置信度判断匹配质量
4. **用户操作记录**：记录用户是否修改、确认
5. **一对多映射支持**：通过关联表或JSON字段支持
6. **完整的审计链**：所有操作都有时间和操作人记录

### 使用流程

1. **数据导入**：源系统科目数据导入，状态=`pending`
2. **自动匹配**：程序执行匹配，填充目标科目和匹配信息，状态=`matched`
3. **用户审核**：用户查看、修改、确认映射结果
4. **确认后处理**：确认的记录（`is_confirmed=1`）进入后续导账流程

详细设计方案已保存在：`02-需求分析/业务分析/科目映射中间表设计方案.md`

## 关键信息提取
- 中间表需要同时记录映射前和映射后的信息
- 需要记录匹配过程（类型、方法、评分、依据）
- 需要支持用户修改和确认操作
- 需要完整的审计追踪
- 需要支持一对多映射
- 参考了用友、金蝶等主流财务软件的设计

## 后续行动
- [x] 完成科目映射中间表设计方案
- [ ] 设计数据库表结构SQL
- [ ] 设计一对多映射的关联表
- [ ] 设计用户界面展示方案

## 备注
详细字段说明和设计意义请参考：`02-需求分析/业务分析/科目映射中间表设计方案.md`
